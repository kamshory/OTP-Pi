<!DOCTYPE html>
<html lang="en">

<head>
    <meta name="require-login" content="true" data-file="/login-form.html">
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1; user-scalable=no">
    <link rel="icon" href="favicon.ico">
    <title>OTP-Pi</title>
    <link href="lib.assets/css/bootstrap.css" rel="stylesheet">
    <link href="lib.assets/css/style.min.css" rel="stylesheet">
    <script src="lib.assets/js/jquery.min.js"></script>
    <script src="lib.assets/js/bootstrap.js"></script>
    <script src="lib.assets/js/ws.min.js"></script>
    <script>
        var modemData = [];
        function handleIncommingMessage(message)
        {
          modemData = getModemData();
          console.log(modemData)
          buildModemMenu(modemData, '#modem');
        }      
        
    </script>
</head>

<body>
    <div class="container">

        <!-- Static navbar -->
        <nav class="navbar navbar-default">
            <div class="container-fluid">
                <div class="navbar-header">
                    <span class="usb-device-symbol"></span>
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar"
                        aria-expanded="false" aria-controls="navbar">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                    <a class="navbar-brand" href="./">OTP-Pi</a>
                </div>

                <div id="navbar" class="navbar-collapse collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="./">Home</a></li>
                        <li><a href="ussd.html">USSD</a></li>
                        <li><a href="sms.html">SMS</a></li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button"
                                aria-haspopup="true" aria-expanded="false">Settings <span class="caret"></span></a>
                            <ul class="dropdown-menu">
                                <li><a href="general-setting.html">General Setting</a></li>
                                <li><a href="admin.html">Administrator Setting</a></li>
                                <li><a href="api-setting.html">API Setting</a></li>
                                <li><a href="api-user.html">API User</a></li>
                                <li><a href="subscriber-setting.html">Subscriber Setting</a></li>
                                <li><a href="sms-setting.html">SMS Setting</a></li>
                                <li><a href="block-list.html">Block List</a></li>
                                <li><a href="modem.html">Modem</a></li>
                                <li><a href="email-account.html">Email Account</a></li>
                                <li><a href="network-setting.html">Network Setting</a></li>
                                <li><a href="firewall.html">Firewall</a></li>
                <li><a href="open-port.html">Open Port</a></li>
                                <li><a href="keystore.html">Keystore</a></li>
                                <li><a href="cron.html">Cron</a></li>
                                <li role="separator" class="divider"></li>
                                <li class="dropdown-header">DDNS Setting</li>
                                <li><a href="ddns-record.html">DDNS Record</a></li>
                                <li><a href="cloudflare.html">Cloudflare Account</a></li>
                                <li><a href="noip.html">No IP Account</a></li>
                                <li><a href="dynu.html">Dynu Account</a></li>
                                <li><a href="afraid.html">Afraid Account</a></li>
                            </ul>
                        </li>
                    </ul>
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="account.html">Account</a></li>
                        <li><a href="logout.html">Logout</a></li>
                    </ul>
                </div>
            </div>
            <!--/.container-fluid -->
        </nav>
        <link rel="stylesheet" href="lib.assets/css/inbox.css">
        <div class="phone-page">
            <div class="select-device">
                <select name="modem" id="modem" class="input-select"></select>
            </div>
            <div class="inbox">
                <div class="button-area">
                <input type="button" class="load-sms btn btn-primary" value="Load">
                <input type="button" class="check-all-sms btn btn-success" value="Check All">
                <input type="button" class="uncheck-all-sms btn btn-success" value="Uncheck All">
                <input type="button" class="delete-sms btn btn-danger" value="Delete">
                </div>
                <div class="message-list">
                    
                    
                </div>
            </div>

<script>
$(document).ready(function(e){
    $(document).on('click', '.load-sms', function(e2){
        var modemID = $('#modem').val();
        $.ajax({
        type:"GET",
        url:"data/sms/inbox/"+modemID,
        dataType:"json",
        success:function(data){
            $('.message-list').empty();
            for(var i in data)
            {
                var sms = data[i];

                var outer = $('<div />');
                outer.attr({'data-modem-id':sms.modemID, 'data-storage':sms.storage, 'data-sms-id':sms.id});
                outer.addClass('message-item');
                var inner = $('<div />');
                inner.addClass('message-item-wrapper');
                var inner1 = $('<div />');
                inner1.addClass('message-sender');
                inner1.text(sms.phoneNumber);

                var inner2 = $('<div />');
                inner2.addClass('message-date-time');
                inner2.text(sms.date.substring(0, 19));

                var inner3 = $('<div />');
                inner3.addClass('message-sim-card');
                inner3.text(sms.modemPort+' - '+sms.modemName);

                var inner4 = $('<div />');
                inner4.addClass('message-action');

                var inner5 = $('<div />');
                inner5.addClass('message-message');
                inner5.html(sms.content.split('\r\n').join('\r\n<br>'));

                inner.append(inner1);
                inner.append(inner2);
                inner.append(inner3);
                inner.append(inner4);
                inner.append(inner5);
                outer.append(inner);

                $('.message-list').append(outer);
            }
        }
    });
    });
    
    $('.message-item').contextmenu(function(e2) {
        if(!$(this).hasClass('message-item-selected'))
        {
            $(this).addClass('message-item-selected');
        }
        else
        {
            $(this).removeClass('message-item-selected');
        }
    });
    $(document).on('dblclick', '.message-item', function(e2){
        if(!$(this).hasClass('message-item-selected'))
        {
            $(this).addClass('message-item-selected');
        }
        else
        {
            $(this).removeClass('message-item-selected');
        }
    });
    $(document).on('click', '.check-all-sms', function(e2){
        $('.message-item').each(function(e3){
            if(!$(this).hasClass('message-item-selected'))
            {
                $(this).addClass('message-item-selected');
            }
        })
    });
    $(document).on('click', '.uncheck-all-sms', function(e2){
        $('.message-item').each(function(e3){
            $(this).removeClass('message-item-selected');
        })
    });
    $(document).on('click', '.delete-sms', function(e2){
        $('.message-item-selected').each(function(e3){
            var modemID = $(this).attr('data-modem-id');
            var smsID = $(this).attr('data-sms-id');
            var storage = $(this).attr('data-storage');
            $.ajax({
                type:"POST",
                url:"api/delete/sms"+modemID,
                dataType:"json",
                data:{action:'delete-sms', modem_id:modemID, sms_id:smsID, storage:storage},
                success:function(data){
                    
                }
            });
            $(this).slideUp(240, function(e4){
                $(this).remove();
            });
        })
    });
});
</script>
        </div>
        <!-- /container -->
    </div>
<div class="waiting-server-up">
    <div class="loading-icon"><span class="animation-pressure"><span></span></span></div>
</div>
</body>

</html>
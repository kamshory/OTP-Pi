var setting={},registrationStatus=["Not registered, MT is not currently searching a new operator to register to","Registered, home network","Not registered, but MT is currently searching a new operator to register to","Registration denied","Unknown (e.g. out of GERAN/UTRAN/E-UTRAN coverage)","Registered, roaming",'Registered for "SMS only", home network (applicable only when indicates E-UTRAN)','Registered for "SMS only", roaming (applicable only when indicates E-UTRAN)',"Attached for emergency bearer services only (see NOTE 2) (not applicable)",'Registered for "CSFB not preferred", home network (applicable only when indicates E-UTRAN)','Registered for "CSFB not preferred", roaming (applicable only when indicates E-UTRAN)'],technology=["GSM","GSM Compact","UTRAN","GSM w/EGPRS","UTRAN w/HSDPA","UTRAN w/HSUPA","UTRAN w/HSDPA and HSUPA","E-UTRAN"],to=setTimeout("",1);function detect(){var a=$('[name="port"]').val().trim();""==a?$('[name="port"]').select():($(".detecting").empty().append('<span class="animation-pressure"><span></span>'),$.ajax({type:"GET",url:"data/modem-info/get/"+encodeURIComponent(a),dataType:"json",success:function(a){$('[name="manufacturer"]').val(a.manufacturer||""),$('[name="model"]').val(a.model||""),$('[name="revision"]').val(a.revision||""),$('[name="imei"]').val(a.imei||""),$('[name="cops_operator"]').val(a.copsOperator),$('[name="msisdn"]').val(a.msisdn||""),$('[name="imsi"]').val(a.imsi||""),$('[name="iccid"]').val(a.iccid||""),$('[name="sms_center"]').val(a.smsCenter||""),$(".detecting").empty();var b=a.networkRegistration||"";b.indexOf(",")>0&&($("#status").attr("data-status",b),$("#status").removeAttr("disabled"))}}))}function applyTag(){if(""!=setting.countryCode&&setting.recipientPrefixLength>0){var c=$('[name="recipient_prefix"]').val(),a=c.split(",");for(var b in a)a[b]=a[b].trim(),0==a[b].indexOf("0")&&a[b].length>1&&(a[b]=setting.countryCode+a[b].substring(1));c=a.join(", "),$('[name="recipient_prefix"]').val(c)}}function loadDetail(){var a=new URLSearchParams(window.location.search).get("id")||"";a.length>0?$.ajax({type:"GET",url:"data/modem/detail/"+a,dataType:"json",success:function(a){$('[name="id"]').val(a.id),$('[name="name"]').val(a.name),$('[name="port"]').val(a.port),$('[name="sms_center"]').val(a.smsCenter),$('[name="manufacturer"]').val(a.manufacturer||""),$('[name="model"]').val(a.model||""),$('[name="revision"]').val(a.revision||""),$('[name="imei"]').val(a.imei),$('[name="cops_operator"]').val(a.copsOperator),$('[name="msisdn"]').val(a.msisdn),$('[name="imsi"]').val(a.imsi),$('[name="iccid"]').val(a.iccid),$('[name="recipient_prefix"]').val(a.recipientPrefix),$('[name="baud_rate"]').val(a.baudRate),$('[name="parity_bit"]').val(a.parityBit),$('[name="start_bits"]').val(a.startBits),$('[name="stop_bits"]').val(a.stopBits),$('[name="internet_access"]').prop("checked",a.internetAccess),$('[name="apn"]').val(a.apn),$('[name="apn_username"]').val(a.apnUsername),$('[name="apn_password"]').val(a.apnPassword),$('[name="dial_number"]').val(a.dialNumner),$('[name="init_dial_1"]').val(a.initDial1),$('[name="init_dial_2"]').val(a.initDial2),$('[name="init_dial_3"]').val(a.initDial3),$('[name="init_dial_4"]').val(a.initDial4),$('[name="init_dial_5"]').val(a.initDial5),$('[name="dial_command"]').val(a.dialCommand),$('[name="autoreconnect"]').prop("checked",a.autoreconnect),$('[name="sms_api"]').prop("checked",a.smsAPI),$('[name="delete_sent_sms"]').prop("checked",a.deleteSentSMS),$('[name="default_modem"]').prop("checked",a.defaultModem),$('[name="active"]').prop("checked",a.active),a.internetAccess&&$(".tr-dial").css("display","table-row"),applyTag()}}):window.location="modem.html"}$(document).ready(function(a){$.ajax({type:"GET",url:"data/sms-setting/get",dataType:"json",success:function(a){setting=a,applyTag()}}),$(document).on("blur",'[name="recipient_prefix"]',function(a){applyTag()}),$(document).on("click",".list-port",function(a){a.preventDefault();var b=$(this);$.ajax({type:"GET",url:"data/serial-port/list",dataType:"json",success:function(a){if(a.length>0){b.closest("tr").find(".list-port-container").css({display:"block"}),b.closest("tr").find(".list-port-container > ul").empty();for(var c=0;c<a.length;c++){var e=$("<li />"),d=$("<a />");d.attr({"data-port":a[c].systemPortName,href:"#"}),d.text(a[c].descriptivePortName),e.append(d),b.closest("tr").find(".list-port-container ul").append(e)}}}})}),$(document).on("mouseover",".list-port-container",function(a){clearTimeout(to),a.preventDefault()}),$(document).on("mouseout",".list-port-container",function(a){var b=$(this);to=setTimeout(function(){b.fadeOut("fast")},1200)}),$(document).on("click",".list-port-container ul li a",function(b){b.preventDefault();var a=$(this).attr("data-port")||"";""!=a&&($(this).closest("tr").find('input[type="text"]').val(a),detect()),$(this).closest("tr").find(".list-port-container").css({display:"none"})}),$(document).on("click","#status",function(d){var a=($("#status").attr("data-status")||"").trim().split(","),b=registrationStatus[parseInt(a[0])]||"",c=technology[parseInt(a[1])]||"";$("#resgistration-status .modal-body").empty(),$("#resgistration-status .modal-body").append('<table class="modal-table modal-table-connection"><tbody><tr><td>Status</td><td>'+b+"</td></tr><tr><td>Technology</td><td>"+c+"</td></tr></tbody></table>"),$("#resgistration-status").modal("show")}),$(document).on("change",'[name="internet_access"]',function(a){$(this).prop("checked")?$(".tr-dial").css("display","table-row"):$(".tr-dial").css("display","none")}),$(document).on("click","#detect",function(a){detect()})})
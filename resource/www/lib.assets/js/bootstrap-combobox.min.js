!function($){"use strict";var a=function(a,b){this.options=$.extend({},$.fn.combobox.defaults,b),this.template=this.options.template||this.template,this.$source=$(a),this.$container=this.setup(),this.$element=this.$container.find("input[type=text]"),this.$target=this.$container.find("input[type=hidden]"),this.$button=this.$container.find(".dropdown-toggle"),this.$menu=$(this.options.menu).appendTo("body"),this.matcher=this.options.matcher||this.matcher,this.sorter=this.options.sorter||this.sorter,this.highlighter=this.options.highlighter||this.highlighter,this.shown=!1,this.selected=!1,this.refresh(),this.transferAttributes(),this.listen()};a.prototype={constructor:a,setup:function(){var a=$(this.template());return this.$source.before(a),this.$source.hide(),a},disable:function(){this.$element.prop("disabled",!0),this.$button.attr("disabled",!0),this.disabled=!0,this.$container.addClass("combobox-disabled")},enable:function(){this.$element.prop("disabled",!1),this.$button.attr("disabled",!1),this.disabled=!1,this.$container.removeClass("combobox-disabled")},parse:function(){var e=this,b={},c=[],a=!1,d="";return this.$source.find("option").each(function(){var f=$(this);if(""===f.val()){e.options.placeholder=f.text();return}b[f.text()]=f.val(),c.push(f.text()),f.prop("selected")&&(a=f.text(),d=f.val())}),this.map=b,a&&(this.$element.val(a),this.$target.val(d),this.$container.addClass("combobox-selected"),this.selected=!0),c},transferAttributes:function(){this.options.placeholder=this.$source.attr("data-placeholder")||this.options.placeholder,"undefined"!==this.options.appendId&&this.$element.attr("id",this.$source.attr("id")+this.options.appendId),this.$element.attr("placeholder",this.options.placeholder),this.$target.prop("name",this.$source.prop("name")),this.$target.val(this.$source.val()),this.$source.removeAttr("name"),this.$element.attr("required",this.$source.attr("required")),this.$element.attr("rel",this.$source.attr("rel")),this.$element.attr("title",this.$source.attr("title")),this.$element.attr("class",this.$source.attr("class")),this.$element.attr("tabindex",this.$source.attr("tabindex")),this.$source.removeAttr("tabindex"),void 0!==this.$source.attr("disabled")&&this.disable()},select:function(){var a=this.$menu.find(".active").attr("data-value");return this.$element.val(this.updater(a)).trigger("change"),this.$target.val(this.map[a]).trigger("change"),this.$source.val(this.map[a]).trigger("change"),this.$container.addClass("combobox-selected"),this.selected=!0,this.hide()},updater:function(a){return a},show:function(){var a=$.extend({},this.$element.position(),{height:this.$element[0].offsetHeight});return this.$menu.insertAfter(this.$element).css({top:a.top+a.height,left:a.left}).show(),$(".dropdown-menu").on("mousedown",$.proxy(this.scrollSafety,this)),this.shown=!0,this},hide:function(){return this.$menu.hide(),$(".dropdown-menu").off("mousedown",$.proxy(this.scrollSafety,this)),this.$element.on("blur",$.proxy(this.blur,this)),this.shown=!1,this},lookup:function(a){return this.query=this.$element.val(),this.process(this.source)},process:function(a){var b=this;return(a=$.grep(a,function(a){return b.matcher(a)}),(a=this.sorter(a)).length)?this.render(a.slice(0,this.options.items)).show():this.shown?this.hide():this},template:function(){return"2"==this.options.bsVersion?'<div class="combobox-container"><input type="hidden" /> <div class="input-append"> <input type="text" autocomplete="off" /> <span class="add-on dropdown-toggle" data-dropdown="dropdown"> <span class="caret"/> <i class="icon-remove"/> </span> </div> </div>':'<div class="combobox-container"> <input type="hidden" /> <div class="input-group"> <input type="text" autocomplete="off" /> <span class="input-group-addon dropdown-toggle" data-dropdown="dropdown"> <span class="caret" /> <span class="glyphicon glyphicon-remove" /> </span> </div> </div>'},matcher:function(a){return~a.toLowerCase().indexOf(this.query.toLowerCase())},sorter:function(e){for(var a,b=[],c=[],d=[];a=e.shift();)a.toLowerCase().indexOf(this.query.toLowerCase())?~a.indexOf(this.query)?c.push(a):d.push(a):b.push(a);return b.concat(c,d)},highlighter:function(a){var b=this.query.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&");return a.replace(new RegExp("("+b+")","ig"),function(b,a){return"<strong>"+a+"</strong>"})},render:function(a){var b=this;return(a=$(a).map(function(a,c){return(a=$(b.options.item).attr("data-value",c)).find("a").html(b.highlighter(c)),a[0]})).first().addClass("active"),this.$menu.html(a),this},next:function(b){var a=this.$menu.find(".active").removeClass("active").next();a.length||(a=$(this.$menu.find("li")[0])),a.addClass("active")},prev:function(b){var a=this.$menu.find(".active").removeClass("active").prev();a.length||(a=this.$menu.find("li").last()),a.addClass("active")},toggle:function(){this.disabled||(this.$container.hasClass("combobox-selected")?(this.clearTarget(),this.triggerChange(),this.clearElement()):this.shown?this.hide():(this.clearElement(),this.lookup()))},scrollSafety:function(a){"UL"==a.target.tagName&&this.$element.off("blur")},clearElement:function(){this.$element.val("").focus()},clearTarget:function(){this.$source.val(""),this.$target.val(""),this.$container.removeClass("combobox-selected"),this.selected=!1},triggerChange:function(){this.$source.trigger("change")},refresh:function(){this.source=this.parse(),this.options.items=this.source.length},listen:function(){this.$element.on("focus",$.proxy(this.focus,this)).on("blur",$.proxy(this.blur,this)).on("keypress",$.proxy(this.keypress,this)).on("keyup",$.proxy(this.keyup,this)),this.eventSupported("keydown")&&this.$element.on("keydown",$.proxy(this.keydown,this)),this.$menu.on("click",$.proxy(this.click,this)).on("mouseenter","li",$.proxy(this.mouseenter,this)).on("mouseleave","li",$.proxy(this.mouseleave,this)),this.$button.on("click",$.proxy(this.toggle,this))},eventSupported:function(a){var b=a in this.$element;return b||(this.$element.setAttribute(a,"return;"),b="function"==typeof this.$element[a]),b},move:function(a){if(this.shown){switch(a.keyCode){case 9:case 13:case 27:a.preventDefault();break;case 38:a.preventDefault(),this.prev(),this.fixMenuScroll();break;case 40:a.preventDefault(),this.next(),this.fixMenuScroll()}a.stopPropagation()}},fixMenuScroll:function(){var a=this.$menu.find(".active");if(a.length){var b=a.position().top,c=b+a.height(),d=this.$menu.scrollTop(),e=this.$menu.height();c>e?this.$menu.scrollTop(d+c-e):b<0&&this.$menu.scrollTop(d+b)}},keydown:function(a){this.suppressKeyPressRepeat=~$.inArray(a.keyCode,[40,38,9,13,27]),this.move(a)},keypress:function(a){this.suppressKeyPressRepeat||this.move(a)},keyup:function(a){switch(a.keyCode){case 40:this.shown||this.toggle();break;case 39:case 38:case 37:case 36:case 35:case 16:case 17:case 18:break;case 9:case 13:if(!this.shown)return;this.select();break;case 27:if(!this.shown)return;this.hide();break;default:this.clearTarget(),this.lookup()}a.stopPropagation(),a.preventDefault()},focus:function(a){this.focused=!0},blur:function(b){var c=this;this.focused=!1;var a=this.$element.val();this.selected||""===a||(this.$element.val(""),this.$source.val("").trigger("change"),this.$target.val("").trigger("change")),!this.mousedover&&this.shown&&setTimeout(function(){c.hide()},200)},click:function(a){a.stopPropagation(),a.preventDefault(),this.select(),this.$element.focus()},mouseenter:function(a){this.mousedover=!0,this.$menu.find(".active").removeClass("active"),$(a.currentTarget).addClass("active")},mouseleave:function(a){this.mousedover=!1}},$.fn.combobox=function(b){return this.each(function(){var d=$(this),c=d.data("combobox");c||d.data("combobox",c=new a(this,"object"==typeof b&&b)),"string"==typeof b&&c[b]()})},$.fn.combobox.defaults={bsVersion:"4",menu:'<ul class="typeahead typeahead-long dropdown-menu"></ul>',item:'<li><a href="#" class="dropdown-item"></a></li>'},$.fn.combobox.Constructor=a}(window.jQuery)
var hostName=location.hostname,portNumber=location.port,scheme=location.protocol,pathname=location.pathname;("/"==pathname||""==pathname)&&(pathname="/index.html");var wsURL=buildWebSoketURL(),ws=null,wsConnected=!1,connetionInterval=setTimeout("",1e3);function broadcast(a){null!=ws&&ws.send(JSON.stringify({command:"broadcast-message",data:[{message:a}]}))}function createBaseURL(e,d,a){var c="";if(-1!=e.indexOf("https")){if(void 0===a||""==a||443==a){var b=444;c="wss://"+d+":"+b}else{var b=parseInt(a)+1;c="wss://"+d+":"+b}}else if(void 0===a||""==a||80==a){var b=81;c="ws://"+d+":"+b}else{var b=parseInt(a)+1;c="ws://"+d+":"+b}return c}function buildWebSoketURL(){var a=new Date().getTime();return createBaseURL(scheme,hostName,portNumber)+"/websocket/manager?time="+a+"&path="+encodeURIComponent(pathname)}function initWebSocket(){"WebSocket"in window?connectWebSocket():console.log("WebSocket is not supported by your browser!")}function waitingForServerUp(){$(".waiting-server-up").css({display:"block"})}function serverUp(){$(".waiting-server-up").css({display:"none"})}function connectWebSocket(){wsURL=buildWebSoketURL(),wsConnected=!1,(ws=new WebSocket(wsURL)).onopen=function(){wsConnected=!0},ws.onmessage=function(d){serverUp();var b=d.data,a=JSON.parse(b);if("broadcast-message"==a.command)for(var c in a.data)showNotif(a.data[c].message,a.data[c].sender_info);else"server-shutdown"==a.command?waitingForServerUp():"server-info"==a.command&&(updateServerInfo(a),updateUSBColor(a));"undefined"!=typeof handleIncommingMessage&&handleIncommingMessage(b)},ws.onclose=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout(function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)},1500)},ws.onError=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout(function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)},1500)}}function createUSB(a){return'    <svg\r\n      xmlns:svg="http://www.w3.org/2000/svg"\r\n      xmlns="http://www.w3.org/2000/svg"\r\n      version="1.0"\r\n      width="47.524799"\r\n      height="22.8092"\r\n      viewBox="0 0 475.248 228.092"\r\n      id="Layer_1"\r\n      xml:space="preserve"><defs\r\n      id="defs1337" />\r\n    <path\r\n      d="M 462.836,114.054 L 412.799,85.158 L 412.799,105.771 L 157.046,105.771 L 206.844,53.159 C 211.082,49.762 216.627,47.379 222.331,47.247 C 245.406,47.247 259.109,47.241 264.153,47.231 C 267.572,56.972 276.756,64.003 287.674,64.003 C 301.486,64.003 312.695,52.795 312.695,38.978 C 312.695,25.155 301.487,13.951 287.674,13.951 C 276.756,13.951 267.572,20.978 264.153,30.711 L 222.821,30.704 C 211.619,30.704 199.881,36.85 192.41,44.055 C 192.614,43.841 192.826,43.613 192.398,44.059 C 192.24,44.237 139.564,99.873 139.564,99.873 C 135.335,103.265 129.793,105.633 124.093,105.769 L 95.161,105.769 C 91.326,86.656 74.448,72.256 54.202,72.256 C 31.119,72.256 12.408,90.967 12.408,114.043 C 12.408,137.126 31.119,155.838 54.202,155.838 C 74.452,155.838 91.33,141.426 95.165,122.297 L 123.59,122.297 C 123.663,122.297 123.736,122.301 123.81,122.297 L 186.681,122.297 C 192.37,122.442 197.905,124.813 202.13,128.209 C 202.13,128.209 254.794,183.841 254.957,184.021 C 255.379,184.468 255.169,184.235 254.961,184.025 C 262.432,191.229 274.175,197.371 285.379,197.371 L 325.211,197.362 L 325.211,214.139 L 375.261,214.139 L 375.261,164.094 L 325.211,164.094 L 325.211,180.849 C 325.211,180.849 314.72,180.83 284.891,180.83 C 279.186,180.699 273.635,178.319 269.399,174.922 L 219.59,122.3 L 412.799,122.3 L 412.799,142.946 L 462.836,114.054 z "\r\n      id="path1334" stoke="'+a+'" fill="'+a+'" />\r\n    </svg>'}function createUSBSymbol(a){$(".usb-device-symbol").html('<a href="modem.html">'+createUSB(a)+"</a>")}function setUSBColor(a){$(".usb-device-symbol svg path").attr("fill",a),$(".usb-device-symbol svg path").attr("stroke",a)}function setModemConnected(a){window.localStorage.setItem("otp-modem-connected",a?"1":"0")}function getModemConnected(){return"1"==(window.localStorage.getItem("otp-modem-connected")||"")}function setWSConnected(a){window.localStorage.setItem("otp-ws-connected",a?"1":"0")}function getWSConnected(){return"1"==(window.localStorage.getItem("otp-ws-connected")||"")}function setAMQPConnected(a){window.localStorage.setItem("otp-amqp-connected",a?"1":"0")}function getAMQPConnected(){return"1"==(window.localStorage.getItem("otp-amqp-connected")||"")}function setRedisConnected(a){window.localStorage.setItem("otp-redis-connected",a?"1":"0")}function getRedisConnected(){return"1"==(window.localStorage.getItem("otp-redis-connected")||"")}function setMQTTConnected(a){window.localStorage.setItem("otp-mqtt-connected",a?"1":"0")}function getMQTTConnected(){return"1"==(window.localStorage.getItem("otp-mqtt-connected")||"")}function setActiveMQConnected(a){window.localStorage.setItem("otp-activemq-connected",a?"1":"0")}function getActiveMQConnected(){return"1"==(window.localStorage.getItem("otp-activemq-connected")||"")}function setWSEnable(a){window.localStorage.setItem("otp-ws-enable",a?"1":"0")}function getWSEnable(){return"1"==(window.localStorage.getItem("otp-ws-enable")||"")}function setAMQPEnable(a){window.localStorage.setItem("otp-amqp-enable",a?"1":"0")}function getAMQPEnable(){return"1"==(window.localStorage.getItem("otp-amqp-enable")||"")}function getStompEnable(){return"1"==(window.localStorage.getItem("otp-stomp-enable")||"")}function getStompConnected(){return"1"==(window.localStorage.getItem("otp-stomp-connected")||"")}function setRedisEnable(a){window.localStorage.setItem("otp-redis-enable",a?"1":"0")}function getRedisEnable(){return"1"==(window.localStorage.getItem("otp-redis-enable")||"")}function setMQTTEnable(a){window.localStorage.setItem("otp-mqtt-enable",a?"1":"0")}function getMQTTEnable(){return"1"==(window.localStorage.getItem("otp-mqtt-enable")||"")}function setActiveMQEnable(a){window.localStorage.setItem("otp-activemq-enable",a?"1":"0")}function setStompEnable(a){window.localStorage.setItem("otp-stomp-enable",a?"1":"0")}function setStompConnected(a){window.localStorage.setItem("otp-stomp-connected",a?"1":"0")}function getActiveMQEnable(){return"1"==(window.localStorage.getItem("otp-activemq-enable")||"")}function setHTTPEnable(a){window.localStorage.setItem("otp-http-enable",a?"1":"0")}function getHTTPEnable(){return"1"==(window.localStorage.getItem("otp-http-enable")||"")}function setHTTPSEnable(a){window.localStorage.setItem("otp-https-enable",a?"1":"0")}function getHTTPSEnable(){return"1"==(window.localStorage.getItem("otp-https-enable")||"")}function setHTTPConnected(a){window.localStorage.setItem("otp-http-connected",a?"1":"0")}function getHTTPConnected(){return"1"==(window.localStorage.getItem("otp-http-connected")||"")}function setHTTPSConnected(a){window.localStorage.setItem("otp-https-connected",a?"1":"0")}function getHTTPSConnected(){return"1"==(window.localStorage.getItem("otp-https-connected")||"")}function updateUSBColor(c){var a=c.data;for(var d in a){var b=a[d];"otp-modem-connected"==b.name&&createUSBSymbol(b.value?"#328C54":"#D83A56")}}function setModemData(a){window.localStorage.setItem("otp-modem-data",JSON.stringify(a))}function getModemData(){var b=window.localStorage.getItem("otp-modem-data")||"{}",a={};try{a=JSON.parse(b)}catch(c){}return a}function updateServerInfo(c){var b=c.data;for(var d in b){var a=b[d];"otp-http-enable"==a.name&&setHTTPEnable(a.value),"otp-https-enable"==a.name&&setHTTPSEnable(a.value),"otp-http-connected"==a.name&&setHTTPConnected(a.value),"otp-https-connected"==a.name&&setHTTPSConnected(a.value),"otp-modem-connected"==a.name&&(setModemConnected(a.value),setModemData(a.data)),"otp-ws-enable"==a.name&&setWSEnable(a.value),"otp-ws-connected"==a.name&&setWSConnected(a.value),"otp-amqp-enable"==a.name&&setAMQPEnable(a.value),"otp-amqp-connected"==a.name&&setAMQPConnected(a.value),"otp-redis-enable"==a.name&&setRedisEnable(a.value),"otp-redis-connected"==a.name&&setRedisConnected(a.value),"otp-mqtt-enable"==a.name&&setMQTTEnable(a.value),"otp-mqtt-connected"==a.name&&setMQTTConnected(a.value),"otp-activemq-enable"==a.name&&setActiveMQEnable(a.value),"otp-activemq-connected"==a.name&&setActiveMQConnected(a.value),"otp-stomp-enable"==a.name&&setStompEnable(a.value),"otp-stomp-connected"==a.name&&setStompConnected(a.value),"feeder"==a.name&&setFeeder(a.feeder)}}function setFeeder(a){var b="object"==typeof a?JSON.stringify(a):"{}";window.localStorage.setItem("otp-feeder",b)}function getFeeder(){var b=window.localStorage.getItem("otp-feeder")||"{}",a={};try{a=JSON.parse(b)}catch(c){a={}}return a}function showNotif(c,a){var b="";void 0!==a&&(b='<div class="notification-sender"><strong>'+a.name+" ("+a.username+")</strong></div>\r\n");var d=$('<div class="notification-item">\r\n<div class="notification-wrapper">\r\n  <div class="notification-close">\r\n    <a href="javascript:;"></a>\r\n  </div>\r\n'+b+'  <div class="notification-message">\r\n    '+c.split("\n").join("<br />")+"\r\n  </div>\r\n</div>\r\n</div>\r\n");$(".notification-container").append(d),setTimeout(function(){d.remove()},6e3)}function getPreferedModemData(a){var c={enable:!1,connected:!1};for(var b in a)if(a.hasOwnProperty(b)&&(a[b].name,a[b].internetAccess&&(c.enable=a[b].active,c.connected=a[b].internetConnected,a[b].internetConnected)))break;return c}function updateDashboard(){var b=getModemConnected(),c=getWSEnable(),d=getWSConnected(),e=getAMQPEnable(),f=getAMQPConnected(),g=getStompEnable(),h=getStompConnected(),i=getMQTTEnable(),j=getMQTTConnected(),k=getActiveMQEnable(),l=getActiveMQConnected(),m=getRedisEnable(),n=getRedisConnected(),o=getHTTPEnable(),p=getHTTPSEnable(),q=getHTTPConnected(),r=getHTTPSConnected(),s=getModemData(),a=getPreferedModemData(s);$(".service-modem-internet").removeClass("connected"),$(".service-modem-internet").removeClass("disconnected"),$(".service-modem-internet").addClass(a.enable?"enable":"disable"),$(".service-modem-internet").addClass(a.connected?"connected":"disconnected"),$(".service-modem, .service-modem-sms").removeClass("connected"),$(".service-modem, .service-modem-sms").removeClass("disconnected"),$(".service-modem, .service-modem-sms").addClass("enable"),$(".service-modem, .service-modem-sms").addClass(b?"connected":"disconnected"),$(".service-http").removeClass("connected"),$(".service-http").removeClass("disconnected"),$(".service-http").removeClass("enable"),$(".service-http").removeClass("disable"),$(".service-http").addClass(o?"enable":"disable"),$(".service-http").addClass(q?"connected":"disconnected"),$(".service-https").removeClass("connected"),$(".service-https").removeClass("disconnected"),$(".service-https").removeClass("enable"),$(".service-https").removeClass("disable"),$(".service-https").addClass(p?"enable":"disable"),$(".service-https").addClass(r?"connected":"disconnected"),$(".service-ws").removeClass("enable"),$(".service-ws").removeClass("disable"),$(".service-ws").removeClass("connected"),$(".service-ws").removeClass("disconnected"),$(".service-ws").addClass(c?"enable":"disable"),$(".service-ws").addClass(d?"connected":"disconnected"),$(".service-amqp").removeClass("enable"),$(".service-amqp").removeClass("disable"),$(".service-amqp").removeClass("connected"),$(".service-amqp").removeClass("disconnected"),$(".service-amqp").addClass(e?"enable":"disable"),$(".service-amqp").addClass(f?"connected":"disconnected"),$(".service-stomp").removeClass("enable"),$(".service-stomp").removeClass("disable"),$(".service-stomp").removeClass("connected"),$(".service-stomp").removeClass("disconnected"),$(".service-stomp").addClass(g?"enable":"disable"),$(".service-stomp").addClass(h?"connected":"disconnected"),$(".service-activemq").removeClass("enable"),$(".service-activemq").removeClass("disable"),$(".service-activemq").removeClass("connected"),$(".service-activemq").removeClass("disconnected"),$(".service-activemq").addClass(k?"enable":"disable"),$(".service-activemq").addClass(l?"connected":"disconnected"),$(".service-redis").removeClass("enable"),$(".service-redis").removeClass("disable"),$(".service-redis").removeClass("connected"),$(".service-redis").removeClass("disconnected"),$(".service-redis").addClass(m?"enable":"disable"),$(".service-redis").addClass(n?"connected":"disconnected"),$(".service-mqtt").removeClass("enable"),$(".service-mqtt").removeClass("disable"),$(".service-mqtt").removeClass("connected"),$(".service-mqtt").removeClass("disconnected"),$(".service-mqtt").addClass(i?"enable":"disable"),$(".service-mqtt").addClass(j?"connected":"disconnected")}function sortObject(a,c=!1){if(!a||"object"!=typeof a)return a;if(Array.isArray(a)){let b=a.map(a=>sortObject(a,c));return c&&b.sort(),b}let d={};return Object.keys(a).sort().forEach(b=>{d[b]=sortObject(a[b],c)}),d}function createPagination(){$('[data-pagination="true"][data-hide="false"]').each(function(w,x){var g,n,b,d,i=$(this),m=parseInt(i.attr("data-max-record")||"0"),f=parseInt(i.attr("data-record-per-page")||"10");f<1&&(f=1),m<0&&(m=0);var h=document.location.toString(),q=(h=h.split("#")[0]).split("?");h=q[0];var u=q[1]||"",r=u.split("&"),a={};for(var v in r){var o=r[v].split("=");""!=o[0]&&(a[o[0]]=o[1])}var s=parseInt(a.offset||"0"),t=Math.floor(m/f);m%f&&t++;var k=s/f+1,l=t,j=k-3,p=k+2;j<0&&(j=0),p>l&&(p=l);var e=0,c=[];if(j>1){for(b in e=(g=0)*f,a.offset=e,c=[],a)c.push(b+"="+a[b]);d=$('<a href="'+(h+"?"+c.join("&"))+'">&laquo;</a> '),i.append(d)}if(j>0){for(b in e=(g=j+1)*f,a.offset=e,c=[],a)c.push(b+"="+a[b]);d=$('<a href="'+(h+"?"+c.join("&"))+'">&lt;</a> '),i.append(d)}for(g=j,n=j+1;g<p;g++,n++){for(b in e=g*f,a.offset=e,c=[],a)c.push(b+"="+a[b]);d=$('<a href="'+(h+"?"+c.join("&"))+'">'+n+"</a> "),e==s&&d.addClass("page-selected"),i.append(d)}if(k<l-2){for(b in e=(g=k)*f,a.offset=e,c=[],a)c.push(b+"="+a[b]);d=$('<a href="'+(h+"?"+c.join("&"))+'">&gt;</a> '),i.append(d)}if(k<l-3){for(b in e=(g=l-1)*f,a.offset=e,c=[],a)c.push(b+"="+a[b]);d=$('<a href="'+(h+"?"+c.join("&"))+'">&raquo;</a> '),i.append(d)}})}function filterData(b,d,f,e){var c={};for(let a in b)b.hasOwnProperty(a)&&(""!=d?f?a.indexOf(d)> -1&&(c[a]=b[a]):a==e&&b[e].indexOf(d)&&(c[a]=b[a]):c[a]=b[a]);return c}function buildModemMenu(a,b){var e=$(b).val()||"";for(var c in $(b).empty(),a)if(a.hasOwnProperty(c)){var f=c,g=a[c].name,h=a[c].port,d=$("<option />");d.attr("value",f),d.append(g+" ("+h+")"),$(b).append(d)}""!=e&&$(b).val(e)}function dateFormat(a){var b=a.getDate(),c=a.getMonth()+1,d=a.getHours(),e=a.getMinutes(),f=a.getSeconds();return b<10&&(b="0"+b),c<10&&(c="0"+c),d<10&&(d="0"+d),e<10&&(e="0"+e),f<10&&(f="0"+f),a.getFullYear()+"-"+c+"-"+b+" "+d+":"+e+":"+f}Object.size=function(a){var b,c=0;for(b in a)a.hasOwnProperty(b)&&c++;return c},$(document).ready(function(a){createUSBSymbol(),$("body").append('<div class="notification-container"></div>'),$(document).on("change",'thead input[type="checkbox"].check-all',function(a){var b=$(this).prop("checked");$(this).closest("table").find('tbody input[type="checkbox"].check-all').each(function(a){$(this).prop("checked",b)})}),$(document).on("click",".notification-close a",function(a){$(this).closest(".notification-item").remove()}),initWebSocket()})
var hostName=location.hostname,portNumber=location.port,scheme=location.protocol,pathname=location.pathname;"/"!=pathname&&""!=pathname||(pathname="/index.html");var wsURL=buildWebSoketURL(),ws=null,wsConnected=!1,connetionInterval=setTimeout("",1e3);function broadcast(message){null!=ws&&ws.send(JSON.stringify({command:"broadcast-message",data:[{message:message}]}))}function createBaseURL(protocol,host,port){var url="",wsPort,wsPort,wsPort,wsPort;-1!=protocol.indexOf("https")?url=void 0===port||""==port||443==port?"wss://"+host+":"+(wsPort=444):"wss://"+host+":"+(wsPort=parseInt(port)+1):url=void 0===port||""==port||80==port?"ws://"+host+":"+(wsPort=81):"ws://"+host+":"+(wsPort=parseInt(port)+1);return url}function buildWebSoketURL(){var date,currentTime=(new Date).getTime();return createBaseURL(scheme,hostName,portNumber)+"/websocket/manager?time="+currentTime+"&path="+encodeURIComponent(pathname)}function initWebSocket(){"WebSocket"in window?connectWebSocket():console.log("WebSocket is not supported by your browser!")}function waitingForServerUp(){$(".waiting-server-up").css({display:"block"})}function serverUp(){$(".waiting-server-up").css({display:"none"})}function connectWebSocket(){wsURL=buildWebSoketURL(),wsConnected=!1,(ws=new WebSocket(wsURL)).onopen=function(){wsConnected=!0},ws.onmessage=function(evt){serverUp();var receivedRaw=evt.data,receivedJSON=JSON.parse(receivedRaw);if("broadcast-message"==receivedJSON.command)for(var i in receivedJSON.data)showNotif(receivedJSON.data[i].message,receivedJSON.data[i].sender_info);else"server-shutdown"==receivedJSON.command?waitingForServerUp():"server-info"==receivedJSON.command&&(updateServerInfo(receivedJSON),updateUSBColor(receivedJSON));"undefined"!=typeof handleIncommingMessage&&handleIncommingMessage(receivedRaw)},ws.onclose=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout((function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)}),1500)},ws.onError=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout((function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)}),1500)}}function createUSB(color){var html;return'    <svg\r\n      xmlns:svg="http://www.w3.org/2000/svg"\r\n      xmlns="http://www.w3.org/2000/svg"\r\n      version="1.0"\r\n      width="47.524799"\r\n      height="22.8092"\r\n      viewBox="0 0 475.248 228.092"\r\n      id="Layer_1"\r\n      xml:space="preserve"><defs\r\n      id="defs1337" />\r\n    <path\r\n      d="M 462.836,114.054 L 412.799,85.158 L 412.799,105.771 L 157.046,105.771 L 206.844,53.159 C 211.082,49.762 216.627,47.379 222.331,47.247 C 245.406,47.247 259.109,47.241 264.153,47.231 C 267.572,56.972 276.756,64.003 287.674,64.003 C 301.486,64.003 312.695,52.795 312.695,38.978 C 312.695,25.155 301.487,13.951 287.674,13.951 C 276.756,13.951 267.572,20.978 264.153,30.711 L 222.821,30.704 C 211.619,30.704 199.881,36.85 192.41,44.055 C 192.614,43.841 192.826,43.613 192.398,44.059 C 192.24,44.237 139.564,99.873 139.564,99.873 C 135.335,103.265 129.793,105.633 124.093,105.769 L 95.161,105.769 C 91.326,86.656 74.448,72.256 54.202,72.256 C 31.119,72.256 12.408,90.967 12.408,114.043 C 12.408,137.126 31.119,155.838 54.202,155.838 C 74.452,155.838 91.33,141.426 95.165,122.297 L 123.59,122.297 C 123.663,122.297 123.736,122.301 123.81,122.297 L 186.681,122.297 C 192.37,122.442 197.905,124.813 202.13,128.209 C 202.13,128.209 254.794,183.841 254.957,184.021 C 255.379,184.468 255.169,184.235 254.961,184.025 C 262.432,191.229 274.175,197.371 285.379,197.371 L 325.211,197.362 L 325.211,214.139 L 375.261,214.139 L 375.261,164.094 L 325.211,164.094 L 325.211,180.849 C 325.211,180.849 314.72,180.83 284.891,180.83 C 279.186,180.699 273.635,178.319 269.399,174.922 L 219.59,122.3 L 412.799,122.3 L 412.799,142.946 L 462.836,114.054 z "\r\n      id="path1334" stoke="'+color+'" fill="'+color+'" />\r\n    </svg>'}function createUSBSymbol(color){$(".usb-device-symbol").html('<a href="modem.html">'+createUSB(color)+"</a>")}function setUSBColor(color){$(".usb-device-symbol svg path").attr("fill",color),$(".usb-device-symbol svg path").attr("stroke",color)}function setModemConnected(value){var key="otp-modem-connected";window.localStorage.setItem(key,value?"1":"0")}function getModemConnected(){var key="otp-modem-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setWSConnected(value){var key="otp-ws-connected";window.localStorage.setItem(key,value?"1":"0")}function getWSConnected(){var key="otp-ws-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setAMQPConnected(value){var key="otp-amqp-connected";window.localStorage.setItem(key,value?"1":"0")}function getAMQPConnected(){var key="otp-amqp-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setRedisConnected(value){var key="otp-redis-connected";window.localStorage.setItem(key,value?"1":"0")}function getRedisConnected(){var key="otp-redis-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setMQTTConnected(value){var key="otp-mqtt-connected";window.localStorage.setItem(key,value?"1":"0")}function getMQTTConnected(){var key="otp-mqtt-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setActiveMQConnected(value){var key="otp-activemq-connected";window.localStorage.setItem(key,value?"1":"0")}function getActiveMQConnected(){var key="otp-activemq-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setWSEnable(value){var key="otp-ws-enable";window.localStorage.setItem(key,value?"1":"0")}function getWSEnable(){var key="otp-ws-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function setAMQPEnable(value){var key="otp-amqp-enable";window.localStorage.setItem(key,value?"1":"0")}function getAMQPEnable(){var key="otp-amqp-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function getStompEnable(){var key="otp-stomp-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function getStompConnected(){var key="otp-stomp-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setRedisEnable(value){var key="otp-redis-enable";window.localStorage.setItem(key,value?"1":"0")}function getRedisEnable(){var key="otp-redis-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function setMQTTEnable(value){var key="otp-mqtt-enable";window.localStorage.setItem(key,value?"1":"0")}function getMQTTEnable(){var key="otp-mqtt-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function setActiveMQEnable(value){var key="otp-activemq-enable";window.localStorage.setItem(key,value?"1":"0")}function setStompEnable(value){var key="otp-stomp-enable";window.localStorage.setItem(key,value?"1":"0")}function setStompConnected(value){var key="otp-stomp-connected";window.localStorage.setItem(key,value?"1":"0")}function getActiveMQEnable(){var key="otp-activemq-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function setHTTPEnable(value){var key="otp-http-enable";window.localStorage.setItem(key,value?"1":"0")}function getHTTPEnable(){var key="otp-http-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function setHTTPSEnable(value){var key="otp-https-enable";window.localStorage.setItem(key,value?"1":"0")}function getHTTPSEnable(){var key="otp-https-enable",value;return"1"==(window.localStorage.getItem(key)||"")}function setHTTPConnected(value){var key="otp-http-connected";window.localStorage.setItem(key,value?"1":"0")}function getHTTPConnected(){var key="otp-http-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function setHTTPSConnected(value){var key="otp-https-connected";window.localStorage.setItem(key,value?"1":"0")}function getHTTPSConnected(){var key="otp-https-connected",value;return"1"==(window.localStorage.getItem(key)||"")}function updateUSBColor(receivedJSON){var data=receivedJSON.data;for(var i in data){var item=data[i];"otp-modem-connected"==item.name&&createUSBSymbol(item.value?"#328C54":"#D83A56")}}function setModemData(modemData){var key="otp-modem-data";window.localStorage.setItem(key,JSON.stringify(modemData))}function getModemData(){var key="otp-modem-data",data=window.localStorage.getItem(key)||"{}",modemData={};try{modemData=JSON.parse(data)}catch(e){}return modemData}function updateServerInfo(receivedJSON){var data=receivedJSON.data;for(var i in data){var item=data[i];"otp-http-enable"==item.name&&setHTTPEnable(item.value),"otp-https-enable"==item.name&&setHTTPSEnable(item.value),"otp-http-connected"==item.name&&setHTTPConnected(item.value),"otp-https-connected"==item.name&&setHTTPSConnected(item.value),"otp-modem-connected"==item.name&&(setModemConnected(item.value),setModemData(item.data)),"otp-ws-enable"==item.name&&setWSEnable(item.value),"otp-ws-connected"==item.name&&setWSConnected(item.value),"otp-amqp-enable"==item.name&&setAMQPEnable(item.value),"otp-amqp-connected"==item.name&&setAMQPConnected(item.value),"otp-redis-enable"==item.name&&setRedisEnable(item.value),"otp-redis-connected"==item.name&&setRedisConnected(item.value),"otp-mqtt-enable"==item.name&&setMQTTEnable(item.value),"otp-mqtt-connected"==item.name&&setMQTTConnected(item.value),"otp-activemq-enable"==item.name&&setActiveMQEnable(item.value),"otp-activemq-connected"==item.name&&setActiveMQConnected(item.value),"otp-stomp-enable"==item.name&&setStompEnable(item.value),"otp-stomp-connected"==item.name&&setStompConnected(item.value),"feeder"==item.name&&setFeeder(item.feeder)}}function setFeeder(feeder){var key="otp-feeder",value="object"==typeof feeder?JSON.stringify(feeder):"{}";window.localStorage.setItem(key,value)}function getFeeder(){var key="otp-feeder",raw=window.localStorage.getItem(key)||"{}",value={};try{value=JSON.parse(raw)}catch(e){value={}}return value}function showNotif(message,senderInfo){var senderInfoHTML="";void 0!==senderInfo&&(senderInfoHTML='<div class="notification-sender"><strong>'+senderInfo.name+" ("+senderInfo.username+")</strong></div>\r\n");var html='<div class="notification-item">\r\n<div class="notification-wrapper">\r\n  <div class="notification-close">\r\n    <a href="javascript:;"></a>\r\n  </div>\r\n'+senderInfoHTML+'  <div class="notification-message">\r\n    '+message.split("\n").join("<br />")+"\r\n  </div>\r\n</div>\r\n</div>\r\n",obj=$(html);$(".notification-container").append(obj),setTimeout((function(){obj.remove()}),6e3)}function getPreferedModemData(modemData){var result={enable:!1,connected:!1};for(var i in modemData)if(modemData.hasOwnProperty(i)){var id=i,name=modemData[i].name;if(modemData[i].internetAccess&&(result.enable=modemData[i].active,result.connected=modemData[i].internetConnected,modemData[i].internetConnected))break}return result}function updateDashboard(){var isModemConnected=getModemConnected(),isWSEmable=getWSEnable(),isWSConnected=getWSConnected(),isAMQPEnable=getAMQPEnable(),isAMQPConnected=getAMQPConnected(),isStompEnable=getStompEnable(),isStompConnected=getStompConnected(),isMQTTEnable=getMQTTEnable(),isMQTTConnected=getMQTTConnected(),isActiveMQEnable=getActiveMQEnable(),isActiveMQConnected=getActiveMQConnected(),isRedisEnable=getRedisEnable(),isRedisConnected=getRedisConnected(),isHTTPEnable=getHTTPEnable(),isHTTPSEnable=getHTTPSEnable(),isHTTPConnected=getHTTPConnected(),isHTTPSConnected=getHTTPSConnected(),modemData,preferedModemData=getPreferedModemData(getModemData());$(".service-modem-internet").removeClass("connected"),$(".service-modem-internet").removeClass("disconnected"),$(".service-modem-internet").addClass(preferedModemData.enable?"enable":"disable"),$(".service-modem-internet").addClass(preferedModemData.connected?"connected":"disconnected"),$(".service-modem, .service-modem-sms").removeClass("connected"),$(".service-modem, .service-modem-sms").removeClass("disconnected"),$(".service-modem, .service-modem-sms").addClass("enable"),$(".service-modem, .service-modem-sms").addClass(isModemConnected?"connected":"disconnected"),$(".service-http").removeClass("connected"),$(".service-http").removeClass("disconnected"),$(".service-http").removeClass("enable"),$(".service-http").removeClass("disable"),$(".service-http").addClass(isHTTPEnable?"enable":"disable"),$(".service-http").addClass(isHTTPConnected?"connected":"disconnected"),$(".service-https").removeClass("connected"),$(".service-https").removeClass("disconnected"),$(".service-https").removeClass("enable"),$(".service-https").removeClass("disable"),$(".service-https").addClass(isHTTPSEnable?"enable":"disable"),$(".service-https").addClass(isHTTPSConnected?"connected":"disconnected"),$(".service-ws").removeClass("enable"),$(".service-ws").removeClass("disable"),$(".service-ws").removeClass("connected"),$(".service-ws").removeClass("disconnected"),$(".service-ws").addClass(isWSEmable?"enable":"disable"),$(".service-ws").addClass(isWSConnected?"connected":"disconnected"),$(".service-amqp").removeClass("enable"),$(".service-amqp").removeClass("disable"),$(".service-amqp").removeClass("connected"),$(".service-amqp").removeClass("disconnected"),$(".service-amqp").addClass(isAMQPEnable?"enable":"disable"),$(".service-amqp").addClass(isAMQPConnected?"connected":"disconnected"),$(".service-stomp").removeClass("enable"),$(".service-stomp").removeClass("disable"),$(".service-stomp").removeClass("connected"),$(".service-stomp").removeClass("disconnected"),$(".service-stomp").addClass(isStompEnable?"enable":"disable"),$(".service-stomp").addClass(isStompConnected?"connected":"disconnected"),$(".service-activemq").removeClass("enable"),$(".service-activemq").removeClass("disable"),$(".service-activemq").removeClass("connected"),$(".service-activemq").removeClass("disconnected"),$(".service-activemq").addClass(isActiveMQEnable?"enable":"disable"),$(".service-activemq").addClass(isActiveMQConnected?"connected":"disconnected"),$(".service-redis").removeClass("enable"),$(".service-redis").removeClass("disable"),$(".service-redis").removeClass("connected"),$(".service-redis").removeClass("disconnected"),$(".service-redis").addClass(isRedisEnable?"enable":"disable"),$(".service-redis").addClass(isRedisConnected?"connected":"disconnected"),$(".service-mqtt").removeClass("enable"),$(".service-mqtt").removeClass("disable"),$(".service-mqtt").removeClass("connected"),$(".service-mqtt").removeClass("disconnected"),$(".service-mqtt").addClass(isMQTTEnable?"enable":"disable"),$(".service-mqtt").addClass(isMQTTConnected?"connected":"disconnected")}function sortObject(unordered,sortArrays=!1){if(!unordered||"object"!=typeof unordered)return unordered;if(Array.isArray(unordered)){const newArr=unordered.map(item=>sortObject(item,sortArrays));return sortArrays&&newArr.sort(),newArr}const ordered={};return Object.keys(unordered).sort().forEach(key=>{ordered[key]=sortObject(unordered[key],sortArrays)}),ordered}function createPagination(){$('[data-pagination="true"][data-hide="false"]').each((function(index,element){var thisPagination=$(this),maxRecord=parseInt(thisPagination.attr("data-max-record")||"0"),recordPerPage=parseInt(thisPagination.attr("data-record-per-page")||"10");recordPerPage<1&&(recordPerPage=1),maxRecord<0&&(maxRecord=0);var originalURL=document.location.toString(),arr0=originalURL.split("#"),arr1=(originalURL=arr0[0]).split("?");originalURL=arr1[0];var args,argArray=(arr1[1]||"").split("&"),queryObject={};for(var i in argArray){var arr2=argArray[i].split("=");""!=arr2[0]&&(queryObject[arr2[0]]=arr2[1])}var currentOffset=parseInt(queryObject.offset||"0"),numPage=Math.floor(maxRecord/recordPerPage);maxRecord%recordPerPage&&numPage++;var currentPage=currentOffset/recordPerPage+1,maxPage=numPage,firstPage=currentPage-3,lastPage=currentPage+2;firstPage<0&&(firstPage=0),lastPage>maxPage&&(lastPage=maxPage);var offset=0,j,k,arr3=[],args3="",l,finalURL,la;if(firstPage>1){for(l in offset=(j=0)*recordPerPage,queryObject.offset=offset,arr3=[],queryObject)arr3.push(l+"="+queryObject[l]);finalURL=originalURL+"?"+(args3=arr3.join("&")),la=$('<a href="'+finalURL+'">&laquo;</a> '),thisPagination.append(la)}if(firstPage>0){for(l in offset=(j=firstPage+1)*recordPerPage,queryObject.offset=offset,arr3=[],queryObject)arr3.push(l+"="+queryObject[l]);finalURL=originalURL+"?"+(args3=arr3.join("&")),la=$('<a href="'+finalURL+'">&lt;</a> '),thisPagination.append(la)}for(j=firstPage,k=firstPage+1;j<lastPage;j++,k++){for(l in offset=j*recordPerPage,queryObject.offset=offset,arr3=[],queryObject)arr3.push(l+"="+queryObject[l]);finalURL=originalURL+"?"+(args3=arr3.join("&")),la=$('<a href="'+finalURL+'">'+k+"</a> "),offset==currentOffset&&la.addClass("page-selected"),thisPagination.append(la)}if(currentPage<maxPage-2){for(l in offset=(j=currentPage)*recordPerPage,queryObject.offset=offset,arr3=[],queryObject)arr3.push(l+"="+queryObject[l]);finalURL=originalURL+"?"+(args3=arr3.join("&")),la=$('<a href="'+finalURL+'">&gt;</a> '),thisPagination.append(la)}if(currentPage<maxPage-3){for(l in offset=(j=maxPage-1)*recordPerPage,queryObject.offset=offset,arr3=[],queryObject)arr3.push(l+"="+queryObject[l]);finalURL=originalURL+"?"+(args3=arr3.join("&")),la=$('<a href="'+finalURL+'">&raquo;</a> '),thisPagination.append(la)}}))}function filterData(data,filterValue,filterByKey,attributeName){var unsorted={};for(const key in data)data.hasOwnProperty(key)&&(""!=filterValue?filterByKey?key.indexOf(filterValue)>-1&&(unsorted[key]=data[key]):key==attributeName&&data[attributeName].indexOf(filterValue)&&(unsorted[key]=data[key]):unsorted[key]=data[key]);return unsorted}function buildModemMenu(modemData,selector){var lastValue=$(selector).val()||"";for(var i in $(selector).empty(),modemData)if(modemData.hasOwnProperty(i)){var id=i,name=modemData[i].name,port=modemData[i].port,opt=$("<option />");opt.attr("value",id),opt.append(name+" ("+port+")"),$(selector).append(opt)}""!=lastValue&&$(selector).val(lastValue)}function dateFormat(today){var dd=today.getDate(),mm=today.getMonth()+1,hh=today.getHours(),ii=today.getMinutes(),ss=today.getSeconds(),yyyy,str;return dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm),hh<10&&(hh="0"+hh),ii<10&&(ii="0"+ii),ss<10&&(ss="0"+ss),today.getFullYear()+"-"+mm+"-"+dd+" "+hh+":"+ii+":"+ss}Object.size=function(obj){var size=0,key;for(key in obj)obj.hasOwnProperty(key)&&size++;return size},$(document).ready((function(e){createUSBSymbol(),$("body").append('<div class="notification-container"></div>'),$(document).on("change",'thead input[type="checkbox"].check-all',(function(e){var checked=$(this).prop("checked");$(this).closest("table").find('tbody input[type="checkbox"].check-all').each((function(e2){$(this).prop("checked",checked)}))})),$(document).on("click",".notification-close a",(function(e2){$(this).closest(".notification-item").remove()})),initWebSocket()}));
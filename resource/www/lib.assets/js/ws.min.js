var hostName=location.hostname,portNumber=location.port,scheme=location.protocol,pathname=location.pathname;"/"!=pathname&&""!=pathname||(pathname="/index.html");var wsURL=buildWebSoketURL(),ws=null,wsConnected=!1,connetionInterval=setTimeout("",1e3);function createBaseURL(e,t,n){return-1!=e.indexOf("https")?void 0===n||""==n||443==n?"wss://"+t+":"+444:"wss://"+t+":"+(parseInt(n)+1):void 0===n||""==n||80==n?"ws://"+t+":"+81:"ws://"+t+":"+(parseInt(n)+1)}function buildWebSoketURL(){var e=(new Date).getTime();return createBaseURL(scheme,hostName,portNumber)+"/websocket/manager?time="+e+"&path="+encodeURIComponent(pathname)}function initWebSocket(){"WebSocket"in window?connectWebSocket():console.log("WebSocket is not supported by your browser!")}function waitingForServerUp(){$(".waiting-server-up").css({display:"block"})}function serverUp(){$(".waiting-server-up").css({display:"none"})}function connectWebSocket(){wsURL=buildWebSoketURL(),wsConnected=!1,(ws=new WebSocket(wsURL)).onopen=function(){wsConnected=!0},ws.onmessage=function(e){serverUp();e=e.data;console.log(e);var t=JSON.parse(e);if("broadcast-message"==t.command)for(var n in t.data)showNotif(t.data[n].message);else"server-shutdown"==t.command?waitingForServerUp():"server-info"==t.command&&(updateServerInfo(t),updateUSBColor(t));"undefined"!=typeof handleIncommingMessage&&handleIncommingMessage(e)},ws.onclose=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout(function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)},1500)},ws.onError=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout(function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)},1500)}}function createUSB(e){return'    <svg\r\n      xmlns:svg="http://www.w3.org/2000/svg"\r\n      xmlns="http://www.w3.org/2000/svg"\r\n      version="1.0"\r\n      width="47.524799"\r\n      height="22.8092"\r\n      viewBox="0 0 475.248 228.092"\r\n      id="Layer_1"\r\n      xml:space="preserve"><defs\r\n      id="defs1337" />\r\n    <path\r\n      d="M 462.836,114.054 L 412.799,85.158 L 412.799,105.771 L 157.046,105.771 L 206.844,53.159 C 211.082,49.762 216.627,47.379 222.331,47.247 C 245.406,47.247 259.109,47.241 264.153,47.231 C 267.572,56.972 276.756,64.003 287.674,64.003 C 301.486,64.003 312.695,52.795 312.695,38.978 C 312.695,25.155 301.487,13.951 287.674,13.951 C 276.756,13.951 267.572,20.978 264.153,30.711 L 222.821,30.704 C 211.619,30.704 199.881,36.85 192.41,44.055 C 192.614,43.841 192.826,43.613 192.398,44.059 C 192.24,44.237 139.564,99.873 139.564,99.873 C 135.335,103.265 129.793,105.633 124.093,105.769 L 95.161,105.769 C 91.326,86.656 74.448,72.256 54.202,72.256 C 31.119,72.256 12.408,90.967 12.408,114.043 C 12.408,137.126 31.119,155.838 54.202,155.838 C 74.452,155.838 91.33,141.426 95.165,122.297 L 123.59,122.297 C 123.663,122.297 123.736,122.301 123.81,122.297 L 186.681,122.297 C 192.37,122.442 197.905,124.813 202.13,128.209 C 202.13,128.209 254.794,183.841 254.957,184.021 C 255.379,184.468 255.169,184.235 254.961,184.025 C 262.432,191.229 274.175,197.371 285.379,197.371 L 325.211,197.362 L 325.211,214.139 L 375.261,214.139 L 375.261,164.094 L 325.211,164.094 L 325.211,180.849 C 325.211,180.849 314.72,180.83 284.891,180.83 C 279.186,180.699 273.635,178.319 269.399,174.922 L 219.59,122.3 L 412.799,122.3 L 412.799,142.946 L 462.836,114.054 z "\r\n      id="path1334" stoke="'+e+'" fill="'+e+'" />\r\n    </svg>'}function createUSBSymbol(e){$(".usb-device-symbol").html('<a href="modem.html">'+createUSB(e)+"</a>")}function setUSBColor(e){$(".usb-device-symbol svg path").attr("fill",e),$(".usb-device-symbol svg path").attr("stroke",e)}function setModemConnected(e){window.localStorage.setItem("otp-modem-connected",e?"1":"0")}function getModemConnected(){return"1"==(window.localStorage.getItem("otp-modem-connected")||"")}function setWSConnected(e){window.localStorage.setItem("otp-ws-connected",e?"1":"0")}function getWSConnected(){return"1"==(window.localStorage.getItem("otp-ws-connected")||"")}function setAMQPConnected(e){window.localStorage.setItem("otp-amqp-connected",e?"1":"0")}function getAMQPConnected(){return"1"==(window.localStorage.getItem("otp-amqp-connected")||"")}function setRedisConnected(e){window.localStorage.setItem("otp-redis-connected",e?"1":"0")}function getRedisConnected(){return"1"==(window.localStorage.getItem("otp-redis-connected")||"")}function setMQTTConnected(e){window.localStorage.setItem("otp-mqtt-connected",e?"1":"0")}function getMQTTConnected(){return"1"==(window.localStorage.getItem("otp-mqtt-connected")||"")}function setWSEnable(e){window.localStorage.setItem("otp-ws-enable",e?"1":"0")}function getWSEnable(){return"1"==(window.localStorage.getItem("otp-ws-enable")||"")}function setAMQPEnable(e){window.localStorage.setItem("otp-amqp-enable",e?"1":"0")}function getAMQPEnable(){return"1"==(window.localStorage.getItem("otp-amqp-enable")||"")}function setRedisEnable(e){window.localStorage.setItem("otp-redis-enable",e?"1":"0")}function getRedisEnable(){return"1"==(window.localStorage.getItem("otp-redis-enable")||"")}function setMQTTEnable(e){window.localStorage.setItem("otp-mqtt-enable",e?"1":"0")}function getMQTTEnable(){return"1"==(window.localStorage.getItem("otp-mqtt-enable")||"")}function setHTTPEnable(e){window.localStorage.setItem("otp-http-enable",e?"1":"0")}function getHTTPEnable(){return"1"==(window.localStorage.getItem("otp-http-enable")||"")}function setHTTPSEnable(e){window.localStorage.setItem("otp-https-enable",e?"1":"0")}function getHTTPSEnable(){return"1"==(window.localStorage.getItem("otp-https-enable")||"")}function setHTTPConnected(e){window.localStorage.setItem("otp-http-connected",e?"1":"0")}function getHTTPConnected(){return"1"==(window.localStorage.getItem("otp-http-connected")||"")}function setHTTPSConnected(e){window.localStorage.setItem("otp-https-connected",e?"1":"0")}function getHTTPSConnected(){return"1"==(window.localStorage.getItem("otp-https-connected")||"")}function updateUSBColor(e){var t,n=e.data;for(t in n){var o=n[t];"otp-modem-connected"==o.name&&createUSBSymbol(o.value?"#328C54":"#D83A56")}}function setModemData(e){window.localStorage.setItem("otp-modem-data",JSON.stringify(e))}function getModemData(){var e=window.localStorage.getItem("otp-modem-data")||"{}",t={};try{t=JSON.parse(e)}catch(e){}return t}function updateServerInfo(e){var t,n=e.data;for(t in n){var o=n[t];"otp-http-enable"==o.name&&setHTTPEnable(o.value),"otp-https-enable"==o.name&&setHTTPSEnable(o.value),"otp-http-connected"==o.name&&setHTTPConnected(o.value),"otp-https-connected"==o.name&&setHTTPSConnected(o.value),"otp-modem-connected"==o.name&&(setModemConnected(o.value),setModemData(o.data)),"otp-ws-enable"==o.name&&setWSEnable(o.value),"otp-ws-connected"==o.name&&setWSConnected(o.value),"otp-amqp-enable"==o.name&&setAMQPEnable(o.value),"otp-amqp-connected"==o.name&&setAMQPConnected(o.value),"otp-redis-enable"==o.name&&setRedisEnable(o.value),"otp-redis-connected"==o.name&&setRedisConnected(o.value),"otp-mqtt-enable"==o.name&&setMQTTEnable(o.value),"otp-mqtt-connected"==o.name&&setMQTTConnected(o.value),"feeder"==o.name&&setFeeder(o.feeder)}}function setFeeder(e){e="object"==typeof e?JSON.stringify(e):"{}";window.localStorage.setItem("otp-feeder",e)}function getFeeder(){var e=window.localStorage.getItem("otp-feeder")||"{}",t={};try{t=JSON.parse(e)}catch(e){t={}}return t}function showNotif(e){var t=$('<div class="notification-item">\r\n<div class="notification-wrapper">\r\n  <div class="notification-close">\r\n    <a href="javascript:;"></a>\r\n  </div>\r\n  <div class="notification-message">\r\n    '+e+"\r\n  </div>\r\n</div>\r\n</div>\r\n");$(".notification-container").append(t),setTimeout(function(){t.remove()},6e3)}function getPreferedModemData(e){var t,n={enable:!1,connected:!1};for(t in e)if(e.hasOwnProperty(t)){e[t].name;if(e[t].internetAccess&&(n.enable=e[t].active,n.connected=e[t].internetConnected,e[t].internetConnected))break}return n}function updateDashboard(){var e=getModemConnected(),t=getWSEnable(),n=getWSConnected(),o=getAMQPEnable(),a=getAMQPConnected(),s=getMQTTEnable(),c=getMQTTConnected(),r=getRedisEnable(),i=getRedisConnected(),d=getHTTPEnable(),l=getHTTPSEnable(),m=getHTTPConnected(),p=getHTTPSConnected(),v=getPreferedModemData(getModemData());$(".service-modem-internet").removeClass("connected"),$(".service-modem-internet").removeClass("disconnected"),$(".service-modem-internet").addClass(v.enable?"enable":"disable"),$(".service-modem-internet").addClass(v.connected?"connected":"disconnected"),$(".service-modem, .service-modem-sms").removeClass("connected"),$(".service-modem, .service-modem-sms").removeClass("disconnected"),$(".service-modem, .service-modem-sms").addClass("enable"),$(".service-modem, .service-modem-sms").addClass(e?"connected":"disconnected"),$(".service-http").removeClass("connected"),$(".service-http").removeClass("disconnected"),$(".service-http").removeClass("enable"),$(".service-http").removeClass("disable"),$(".service-http").addClass(d?"enable":"disable"),$(".service-http").addClass(m?"connected":"disconnected"),$(".service-https").removeClass("connected"),$(".service-https").removeClass("disconnected"),$(".service-https").removeClass("enable"),$(".service-https").removeClass("disable"),$(".service-https").addClass(l?"enable":"disable"),$(".service-https").addClass(p?"connected":"disconnected"),$(".service-ws").removeClass("enable"),$(".service-ws").removeClass("disable"),$(".service-ws").removeClass("connected"),$(".service-ws").removeClass("disconnected"),$(".service-ws").addClass(t?"enable":"disable"),$(".service-ws").addClass(n?"connected":"disconnected"),$(".service-amqp").removeClass("enable"),$(".service-amqp").removeClass("disable"),$(".service-amqp").removeClass("connected"),$(".service-amqp").removeClass("disconnected"),$(".service-amqp").addClass(o?"enable":"disable"),$(".service-amqp").addClass(a?"connected":"disconnected"),$(".service-redis").removeClass("enable"),$(".service-redis").removeClass("disable"),$(".service-redis").removeClass("connected"),$(".service-amqp").removeClass("disconnected"),$(".service-redis").addClass(r?"enable":"disable"),$(".service-redis").addClass(i?"connected":"disconnected"),$(".service-mqtt").removeClass("enable"),$(".service-mqtt").removeClass("disable"),$(".service-mqtt").removeClass("connected"),$(".service-mqtt").removeClass("disconnected"),$(".service-mqtt").addClass(s?"enable":"disable"),$(".service-mqtt").addClass(c?"connected":"disconnected")}function sortObject(t,n=!1){if(!t||"object"!=typeof t)return t;if(Array.isArray(t)){const e=t.map(e=>sortObject(e,n));return n&&e.sort(),e}const o={};return Object.keys(t).sort().forEach(e=>{o[e]=sortObject(t[e],n)}),o}function createPagination(){$('[data-pagination="true"][data-hide="false"]').each(function(e,t){var n=$(this),o=parseInt(n.attr("data-max-record")||"0"),a=parseInt(n.attr("data-record-per-page")||"10");a<1&&(a=1),o<0&&(o=0);var s=document.location.toString(),c=(s=s.split("#")[0]).split("?");s=c[0];var r,i=(c[1]||"").split("&"),d={};for(r in i){var l=i[r].split("=");""!=l[0]&&(d[l[0]]=l[1])}var m=parseInt(d.offset||"0"),p=Math.floor(o/a);o%a&&p++;var c=m/a+1,o=p,p=c-3,v=2+c;p<0&&(p=0),o<v&&(v=o);var u,f,b,w,g,C=0,h=[];if(1<p){for(b in C=(u=0)*a,d.offset=C,h=[],d)h.push(b+"="+d[b]);w=s+"?"+h.join("&"),g=$('<a href="'+w+'">&laquo;</a> '),n.append(g)}if(0<p){for(b in C=(u=p+1)*a,d.offset=C,h=[],d)h.push(b+"="+d[b]);w=s+"?"+h.join("&"),g=$('<a href="'+w+'">&lt;</a> '),n.append(g)}for(f=(u=p)+1;u<v;u++,f++){for(b in C=u*a,d.offset=C,h=[],d)h.push(b+"="+d[b]);w=s+"?"+h.join("&"),g=$('<a href="'+w+'">'+f+"</a> "),C==m&&g.addClass("page-selected"),n.append(g)}if(c<o-2){for(b in C=(u=c)*a,d.offset=C,h=[],d)h.push(b+"="+d[b]);w=s+"?"+h.join("&"),g=$('<a href="'+w+'">&gt;</a> '),n.append(g)}if(c<o-3){for(b in C=(u=o-1)*a,d.offset=C,h=[],d)h.push(b+"="+d[b]);w=s+"?"+h.join("&"),g=$('<a href="'+w+'">&raquo;</a> '),n.append(g)}})}function filterData(e,t,n,o){var a={};for(const s in e)e.hasOwnProperty(s)&&(""!=t?n?-1<s.indexOf(t)&&(a[s]=e[s]):s==o&&e[o].indexOf(t)&&(a[s]=e[s]):a[s]=e[s]);return a}function buildModemMenu(e,t){var n,o,a,s,c,r=$(t).val()||"";for(n in $(t).empty(),e)e.hasOwnProperty(n)&&(a=e[o=n].name,s=e[n].port,(c=$("<option />")).attr("value",o),c.append(a+" ("+s+")"),$(t).append(c));""!=r&&$(t).val(r)}function dateFormat(e){var t=e.getDate(),n=e.getMonth()+1,o=e.getHours(),a=e.getMinutes(),s=e.getSeconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),a<10&&(a="0"+a),s<10&&(s="0"+s),e.getFullYear()+"-"+n+"-"+t+" "+o+":"+a+":"+s}Object.size=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},$(document).ready(function(e){createUSBSymbol(),$("body").append('<div class="notification-container"></div>'),$(document).on("change",'thead input[type="checkbox"].check-all',function(e){var t=$(this).prop("checked");$(this).closest("table").find('tbody input[type="checkbox"].check-all').each(function(e){$(this).prop("checked",t)})}),$(document).on("click",".notification-close a",function(e){$(this).closest(".notification-item").remove()}),initWebSocket()});
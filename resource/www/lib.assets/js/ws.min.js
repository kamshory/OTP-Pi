var hostName=location.hostname,portNumber=location.port,scheme=location.protocol,pathname=location.pathname;"/"!=pathname&&""!=pathname||(pathname="/index.html");var wsURL=createBaseURL(scheme,hostName,portNumber)+"/websocket/manager?path="+encodeURIComponent(pathname),ws=null,wsConnected=!1,connetionInterval=setTimeout("",1e3);function createBaseURL(e,t,n){var o="";-1!=e.indexOf("https")?o=void 0===n||""==n||443==n?"wss://"+t+":"+444:"wss://"+t+":"+(parseInt(n)+1):o=void 0===n||""==n||80==n?"ws://"+t+":"+81:"ws://"+t+":"+(parseInt(n)+1);return o}function initWebSocket(){"WebSocket"in window?connectWebSocket():console.log("WebSocket is not supported by your browser!")}function waitingForServerUp(){$(".waiting-server-up").css({display:"block"})}function serverUp(){$(".waiting-server-up").css({display:"none"})}function connectWebSocket(){wsConnected=!1,(ws=new WebSocket(wsURL)).onopen=function(){wsConnected=!0},ws.onmessage=function(e){serverUp();var t=e.data;console.log(t);var n=JSON.parse(t);if("broadcast-message"==n.command)for(var o in n.data)showNotif(n.data[o].message);else"server-shutdown"==n.command?waitingForServerUp():"server-info"==n.command&&(updateServerInfo(n),updateUSBColor(n));"undefined"!=typeof handleIncommingMessage&&handleIncommingMessage(t)},ws.onclose=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout(function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)},1500)},ws.onError=function(){wsConnected=!1,clearTimeout(connectWebSocket),connetionInterval=setTimeout(function(){connectWebSocket(),wsConnected&&clearTimeout(connectWebSocket)},1500)}}function createUSB(e){return'    <svg\r\n      xmlns:svg="http://www.w3.org/2000/svg"\r\n      xmlns="http://www.w3.org/2000/svg"\r\n      version="1.0"\r\n      width="47.524799"\r\n      height="22.8092"\r\n      viewBox="0 0 475.248 228.092"\r\n      id="Layer_1"\r\n      xml:space="preserve"><defs\r\n      id="defs1337" />\r\n    <path\r\n      d="M 462.836,114.054 L 412.799,85.158 L 412.799,105.771 L 157.046,105.771 L 206.844,53.159 C 211.082,49.762 216.627,47.379 222.331,47.247 C 245.406,47.247 259.109,47.241 264.153,47.231 C 267.572,56.972 276.756,64.003 287.674,64.003 C 301.486,64.003 312.695,52.795 312.695,38.978 C 312.695,25.155 301.487,13.951 287.674,13.951 C 276.756,13.951 267.572,20.978 264.153,30.711 L 222.821,30.704 C 211.619,30.704 199.881,36.85 192.41,44.055 C 192.614,43.841 192.826,43.613 192.398,44.059 C 192.24,44.237 139.564,99.873 139.564,99.873 C 135.335,103.265 129.793,105.633 124.093,105.769 L 95.161,105.769 C 91.326,86.656 74.448,72.256 54.202,72.256 C 31.119,72.256 12.408,90.967 12.408,114.043 C 12.408,137.126 31.119,155.838 54.202,155.838 C 74.452,155.838 91.33,141.426 95.165,122.297 L 123.59,122.297 C 123.663,122.297 123.736,122.301 123.81,122.297 L 186.681,122.297 C 192.37,122.442 197.905,124.813 202.13,128.209 C 202.13,128.209 254.794,183.841 254.957,184.021 C 255.379,184.468 255.169,184.235 254.961,184.025 C 262.432,191.229 274.175,197.371 285.379,197.371 L 325.211,197.362 L 325.211,214.139 L 375.261,214.139 L 375.261,164.094 L 325.211,164.094 L 325.211,180.849 C 325.211,180.849 314.72,180.83 284.891,180.83 C 279.186,180.699 273.635,178.319 269.399,174.922 L 219.59,122.3 L 412.799,122.3 L 412.799,142.946 L 462.836,114.054 z "\r\n      id="path1334" stoke="'+e+'" fill="'+e+'" />\r\n    </svg>'}function createUSBSymbol(e){$(".usb-device-symbol").html('<a href="modem.html">'+createUSB(e)+"</a>")}function setUSBColor(e){$(".usb-device-symbol svg path").attr("fill",e),$(".usb-device-symbol svg path").attr("stroke",e)}function setModemConnected(e){window.localStorage.setItem("otp-modem-connected",e?"1":"0")}function getModemConnected(){return"1"==(window.localStorage.getItem("otp-modem-connected")||"")}function setWSConnected(e){window.localStorage.setItem("otp-ws-connected",e?"1":"0"),console.log("otp-ws-connected",e)}function getWSConnected(){return"1"==(window.localStorage.getItem("otp-ws-connected")||"")}function setAMQPConnected(e){window.localStorage.setItem("otp-amqp-connected",e?"1":"0")}function getAMQPConnected(){return"1"==(window.localStorage.getItem("otp-amqp-connected")||"")}function setWSEnable(e){window.localStorage.setItem("otp-ws-enable",e?"1":"0"),console.log("otp-ws-enable",e)}function getWSEnable(){return"1"==(window.localStorage.getItem("otp-ws-enable")||"")}function setAMQPEnable(e){window.localStorage.setItem("otp-amqp-enable",e?"1":"0")}function getAMQPEnable(){return"1"==(window.localStorage.getItem("otp-amqp-enable")||"")}function setHTTPEnable(e){window.localStorage.setItem("otp-http-enable",e?"1":"0")}function getHTTPEnable(){return"1"==(window.localStorage.getItem("otp-http-enable")||"")}function updateUSBColor(e){var t=e.data;for(var n in t){var o=t[n];"otp-modem-connected"==o.name&&createUSBSymbol(o.value?"#328C54":"#D83A56")}}function setModemData(e){window.localStorage.setItem("otp-modem-data",JSON.stringify(e))}function getModemData(){var e=window.localStorage.getItem("otp-modem-data")||"{}",t={};try{t=JSON.parse(e)}catch(e){}return t}function updateServerInfo(e){var t=e.data;for(var n in t){var o=t[n];"otp-http-enable"==o.name&&setHTTPEnable(o.value),"otp-modem-connected"==o.name&&(setModemConnected(o.value),setModemData(o.data)),"otp-ws-enable"==o.name&&setWSEnable(o.value),"otp-ws-connected"==o.name&&setWSConnected(o.value),"otp-amqp-enable"==o.name&&setAMQPEnable(o.value),"otp-amqp-connected"==o.name&&setAMQPConnected(o.value),"feeder"==o.name&&setFeeder(o.feeder)}}function setFeeder(e){var t="object"==typeof e?JSON.stringify(e):"{}";window.localStorage.setItem("otp-feeder",t)}function getFeeder(){var e=window.localStorage.getItem("otp-feeder")||"{}",t={};try{t=JSON.parse(e)}catch(e){t={}}return t}function showNotif(e){var t=$('<div class="notification-item">\r\n<div class="notification-wrapper">\r\n  <div class="notification-close">\r\n    <a href="javascript:;"></a>\r\n  </div>\r\n  <div class="notification-message">\r\n    '+e+"\r\n  </div>\r\n</div>\r\n</div>\r\n");$(".notification-container").append(t),setTimeout(function(){t.remove()},6e3)}function updateDashboard(){var e=getModemConnected(),t=getWSEnable(),n=getWSConnected(),o=getAMQPEnable(),a=getAMQPConnected(),c=getHTTPEnable();$(".service-modem").removeClass("connected"),$(".service-modem").removeClass("disconnected"),$(".service-modem").addClass("enable"),$(".service-modem").addClass(e?"connected":"disconnected"),$(".service-http").removeClass("connected"),$(".service-http").removeClass("disconnected"),$(".service-http").removeClass("enable"),$(".service-http").removeClass("disable"),$(".service-http").addClass(c?"enable":"disable"),$(".service-http").addClass(c?"connected":"disconnected"),$(".service-ws").removeClass("enable"),$(".service-ws").removeClass("disable"),$(".service-ws").removeClass("connected"),$(".service-ws").removeClass("disconnected"),$(".service-ws").addClass(t?"enable":"disable"),$(".service-ws").addClass(n?"connected":"disconnected"),$(".service-amqp").removeClass("enable"),$(".service-amqp").removeClass("disable"),$(".service-amqp").removeClass("connected"),$(".service-amqp").removeClass("disconnected"),$(".service-amqp").addClass(o?"enable":"disable"),$(".service-amqp").addClass(a?"connected":"disconnected")}function sortObject(e,t=!1){if(!e||"object"!=typeof e)return e;if(Array.isArray(e)){const n=e.map(e=>sortObject(e,t));return t&&n.sort(),n}const n={};return Object.keys(e).sort().forEach(o=>{n[o]=sortObject(e[o],t)}),n}function createPagination(){$('[data-pagination="true"][data-hide="false"]').each(function(e,t){var n=$(this),o=parseInt(n.attr("data-max-record")||"0"),a=parseInt(n.attr("data-record-per-page")||"10");a<1&&(a=1),o<0&&(o=0);var c=document.location.toString(),r=c.split("#"),s=(c=r[0]).split("?");c=s[0];var i=(s[1]||"").split("&"),d={};for(var l in i){var p=i[l].split("=");""!=p[0]&&(d[p[0]]=p[1])}var m=parseInt(d.offset||"0"),f=Math.floor(o/a);o%a&&f++;var v=m/a+1,u=f,w=v-3,g=v+2;w<0&&(w=0),g>u&&(g=u);var b,h,C,S,y,I=0,k=[];if(w>1){for(C in I=(b=0)*a,d.offset=I,k=[],d)k.push(C+"="+d[C]);S=c+"?"+k.join("&"),y=$('<a href="'+S+'">&laquo;</a> '),n.append(y)}if(w>0){for(C in I=(b=w+1)*a,d.offset=I,k=[],d)k.push(C+"="+d[C]);S=c+"?"+k.join("&"),y=$('<a href="'+S+'">&lt;</a> '),n.append(y)}for(b=w,h=w+1;b<g;b++,h++){for(C in I=b*a,d.offset=I,k=[],d)k.push(C+"="+d[C]);S=c+"?"+k.join("&"),y=$('<a href="'+S+'">'+h+"</a> "),I==m&&y.addClass("page-selected"),n.append(y)}if(v<u-2){for(C in I=(b=v)*a,d.offset=I,k=[],d)k.push(C+"="+d[C]);S=c+"?"+k.join("&"),y=$('<a href="'+S+'">&gt;</a> '),n.append(y)}if(v<u-3){for(C in I=(b=u-1)*a,d.offset=I,k=[],d)k.push(C+"="+d[C]);S=c+"?"+k.join("&"),y=$('<a href="'+S+'">&raquo;</a> '),n.append(y)}})}function filterData(e,t,n,o){var a={};for(const c in e)e.hasOwnProperty(c)&&(""!=t?n?c.indexOf(t)>-1&&(a[c]=e[c]):c==o&&e[o].indexOf(t)&&(a[c]=e[c]):a[c]=e[c]);return a}function buildModemMenu(e,t){var n=$(t).val()||"";for(var o in $(t).empty(),e)if(e.hasOwnProperty(o)){var a=o,c=e[o].name,r=e[o].port,s=$("<option />");s.attr("value",a),s.append(c+" ("+r+")"),$(t).append(s)}""!=n&&$(t).val(n)}function dateFormat(e){var t=e.getDate(),n=e.getMonth()+1,o=e.getHours(),a=e.getMinutes(),c=e.getSeconds();return t<10&&(t="0"+t),n<10&&(n="0"+n),o<10&&(o="0"+o),a<10&&(a="0"+a),c<10&&(c="0"+c),e.getFullYear()+"-"+n+"-"+t+" "+o+":"+a+":"+c}Object.size=function(e){var t,n=0;for(t in e)e.hasOwnProperty(t)&&n++;return n},$(document).ready(function(e){createUSBSymbol(),$("body").append('<div class="notification-container"></div>'),$(document).on("change",'thead input[type="checkbox"].check-all',function(e){var t=$(this).prop("checked");$(this).closest("table").find('tbody input[type="checkbox"].check-all').each(function(e){$(this).prop("checked",t)})}),$(document).on("click",".notification-close a",function(e){$(this).closest(".notification-item").remove()}),initWebSocket()});